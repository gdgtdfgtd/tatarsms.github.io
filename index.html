<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>tatarsms | Premium P2P</title>
    <link rel="stylesheet" href="style.css">
    <!-- Библиотеки -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
</head>
<body>

    <!-- Экран загрузки -->
    <div id="loader" class="loader-overlay">
        <div class="loader-content">
            <div class="spinner"></div>
            <p>Инициализация TATARSMS...</p>
        </div>
    </div>

    <!-- ЭКРАН ВХОДА И РЕГИСТРАЦИИ -->
    <div id="auth-screen" class="auth-wrapper hidden">
        <div class="auth-container">
            <div class="auth-card">
                <div class="auth-header">
                    <h1 class="logo-text">tatarsms</h1>
                    <p id="auth-desc">Войдите в свою учетную запись</p>
                </div>
                
                <div id="auth-form">
                    <div class="input-group">
                        <label>Никнейм (ID)</label>
                        <input type="text" id="auth-login" placeholder="Напр: tatar_user">
                    </div>
                    <div class="input-group">
                        <label>Пароль</label>
                        <input type="password" id="auth-pass" placeholder="••••••••">
                    </div>
                    
                    <div id="reg-extra" class="hidden">
                        <div class="input-group">
                            <label>Аватар</label>
                            <div class="avatar-setup">
                                <img id="reg-preview" src="https://api.dicebear.com/7.x/avataaars/svg?seed=tatar" alt="">
                                <button type="button" class="btn-small" onclick="document.getElementById('reg-file').click()">Выбрать фото</button>
                                <input type="file" id="reg-file" hidden accept="image/*">
                            </div>
                        </div>
                    </div>

                    <button class="btn-main" id="btn-submit" onclick="auth.submit()">Войти</button>
                    <p class="auth-toggle">Нет аккаунта? <span onclick="auth.toggleMode()">Зарегистрироваться</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- ГЛАВНОЕ ПРИЛОЖЕНИЕ -->
    <div id="app" class="app-layout hidden">
        <!-- Левое меню (Навигация) -->
        <nav class="nav-bar">
            <div class="nav-top">
                <div class="nav-item active" onclick="ui.tab('chats')"><i class="fas fa-comment-dots"></i></div>
                <div class="nav-item" onclick="ui.tab('channels')"><i class="fas fa-bullhorn"></i></div>
                <div class="nav-item" onclick="ui.tab('cloud')"><i class="fas fa-cloud"></i></div>
            </div>
            <div class="nav-bottom">
                <div class="nav-item" onclick="ui.openModal('settings')"><i class="fas fa-cog"></i></div>
            </div>
        </nav>

        <!-- Сайдбар (Список чатов) -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Чаты</h2>
                <div class="header-btns">
                    <button onclick="ui.openModal('add-peer')"><i class="fas fa-plus"></i></button>
                    <button class="mobile-only" onclick="ui.toggleSidebar()"><i class="fas fa-times"></i></button>
                </div>
            </div>
            <div class="search-wrap">
                <input type="text" id="peer-search" placeholder="Поиск людей и каналов..." oninput="ui.filterPeers()">
            </div>
            <div class="peer-list" id="peer-list">
                <!-- Контакты -->
            </div>
        </aside>

        <!-- Основная зона (Чат) -->
        <main class="chat-view">
            <div id="no-chat-selected" class="empty-view">
                <div class="empty-content">
                    <i class="fas fa-comments"></i>
                    <h3>Выберите чат</h3>
                    <p>Найдите друга по ID или создайте новый канал</p>
                </div>
            </div>

            <div id="chat-active" class="chat-container hidden">
                <header class="chat-header">
                    <div class="chat-info">
                        <button class="mobile-only back-btn" onclick="ui.toggleSidebar()"><i class="fas fa-chevron-left"></i></button>
                        <img id="chat-avatar" src="" alt="">
                        <div class="chat-titles">
                            <h3 id="chat-name">Nickname</h3>
                            <span id="chat-status">в сети</span>
                        </div>
                    </div>
                    <div class="chat-actions">
                        <button onclick="calls.init(false)"><i class="fas fa-phone"></i></button>
                        <button onclick="calls.init(true)"><i class="fas fa-video"></i></button>
                    </div>
                </header>

                <div class="message-list" id="message-list">
                    <!-- Сообщения -->
                </div>

                <div class="chat-footer">
                    <div class="input-container">
                        <button class="tool-btn" onclick="ui.toggleStickers()"><i class="far fa-sticky-note"></i></button>
                        <button class="tool-btn" onclick="document.getElementById('file-input').click()"><i class="fas fa-paperclip"></i></button>
                        <input type="file" id="file-input" hidden multiple>
                        
                        <div class="msg-input-wrapper">
                            <input type="text" id="msg-input" placeholder="Напишите сообщение...">
                        </div>

                        <button class="voice-btn" id="voice-rec-btn" onmousedown="voice.start()" onmouseup="voice.stop()"><i class="fas fa-microphone"></i></button>
                        <button class="send-btn" onclick="messenger.send()"><i class="fas fa-paper-plane"></i></button>
                    </div>

                    <!-- Панель стикеров -->
                    <div id="sticker-panel" class="sticker-panel hidden">
                        <div class="sticker-header">
                            <span>Стикеры</span>
                            <button onclick="ui.openModal('add-sticker')">+</button>
                        </div>
                        <div class="sticker-grid" id="sticker-grid"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- МОДАЛЬНЫЕ ОКНА -->
    <div id="modal-overlay" class="modal-overlay hidden">
        <!-- Настройки -->
        <div id="modal-settings" class="modal hidden">
            <div class="modal-header">
                <h3>Настройки</h3>
                <button onclick="ui.closeModals()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-item">
                    <label>Сменить аватар</label>
                    <input type="file" id="change-av-file" onchange="user.updateAvatar(this)">
                </div>
                <div class="setting-item">
                    <label>О себе</label>
                    <textarea id="set-bio" placeholder="Расскажите о себе..."></textarea>
                </div>
                <div class="setting-item">
                    <label>Верификация</label>
                    <button class="btn-small" onclick="ui.verifyRequest()">Запросить синий чек</button>
                </div>
                
                <div id="admin-section" class="admin-zone hidden">
                    <hr>
                    <h4>Панель Администратора</h4>
                    <button class="btn-main" onclick="ui.openModal('create-twink')">Создать Твинк-аккаунт</button>
                    <button class="btn-main danger" onclick="admin.clearStorage()">Сбросить всё (DB)</button>
                </div>

                <button class="btn-main danger" style="margin-top: 20px;" onclick="auth.logout()">Выйти из аккаунта</button>
            </div>
        </div>

        <!-- Создание твинка -->
        <div id="modal-create-twink" class="modal hidden">
            <div class="modal-header">
                <h3>Создать твинк</h3>
                <button onclick="ui.closeModals()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="text" id="twink-login" placeholder="Логин для твинка">
                <input type="password" id="twink-pass" placeholder="Пароль для твинка">
                <button class="btn-main" onclick="admin.createTwink()">Создать и сохранить в DB</button>
            </div>
        </div>

        <!-- Поиск друга -->
        <div id="modal-add-peer" class="modal hidden">
            <div class="modal-header">
                <h3>Добавить контакт</h3>
                <button onclick="ui.closeModals()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="text" id="new-peer-id" placeholder="Введите Peer ID друга">
                <button class="btn-main" onclick="messenger.addContact()">Найти и добавить</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
