<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>tatarsms | Premium P2P</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
</head>
<body>

    <!-- Загрузочный экран -->
    <div id="loader" class="loader-overlay">
        <div class="loader-content">
            <div class="logo-animation">t</div>
            <p>tatarsms</p>
        </div>
    </div>

    <!-- Авторизация -->
    <div id="auth-screen" class="modal-overlay">
        <div class="auth-card">
            <h1 class="brand">tatarsms</h1>
            <div id="auth-ui">
                <div class="input-group">
                    <label>Никнейм (ID)</label>
                    <input type="text" id="auth-id" placeholder="tatar_user">
                </div>
                <div class="input-group">
                    <label>Пароль</label>
                    <input type="password" id="auth-pw" placeholder="••••••••">
                </div>
                <div id="reg-fields" class="hidden">
                    <div class="input-group">
                        <label>Ссылка на аватар</label>
                        <input type="text" id="auth-av" placeholder="https://...">
                    </div>
                </div>
                <button class="btn-primary" onclick="account.submit()">Войти</button>
                <p class="toggle-text">Нет аккаунта? <span onclick="account.toggle()">Создать</span></p>
            </div>
        </div>
    </div>

    <!-- Основное приложение -->
    <div id="app" class="app-container hidden">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="my-profile" onclick="ui.modal('settings')">
                    <img id="my-av" src="" alt="">
                    <div class="status-dot online"></div>
                </div>
                <h3>Чаты</h3>
                <button class="icon-btn" onclick="ui.modal('add-peer')"><i class="fas fa-plus"></i></button>
            </div>
            <div class="search-bar">
                <input type="text" placeholder="Поиск..." oninput="ui.filter(this.value)">
            </div>
            <div class="contact-list" id="contact-list"></div>
        </aside>

        <main class="chat-window">
            <div id="chat-welcome" class="welcome-screen">
                <i class="fas fa-comment-alt"></i>
                <h2>Выберите чат</h2>
                <p>Все сообщения зашифрованы P2P</p>
            </div>

            <div id="chat-active" class="hidden">
                <header class="chat-header">
                    <div class="header-info">
                        <button class="mobile-only back-btn" onclick="ui.toggleSidebar()"><i class="fas fa-chevron-left"></i></button>
                        <img id="target-av" src="" alt="">
                        <div>
                            <h4 id="target-name">User</h4>
                            <small id="target-status">в сети</small>
                        </div>
                    </div>
                    <div class="header-actions">
                        <button onclick="calls.start(false)"><i class="fas fa-phone"></i></button>
                        <button onclick="calls.start(true)"><i class="fas fa-video"></i></button>
                    </div>
                </header>

                <div class="messages" id="message-box"></div>

                <div class="chat-input-area">
                    <div class="input-tools">
                        <button onclick="ui.toggleStickers()"><i class="far fa-sticky-note"></i></button>
                        <label for="file-input"><i class="fas fa-paperclip"></i></label>
                        <input type="file" id="file-input" hidden onchange="messenger.file(this)">
                    </div>
                    <input type="text" id="msg-input" placeholder="Написать..." onkeypress="messenger.press(event)">
                    <button id="mic-btn" onmousedown="voice.start()" onmouseup="voice.stop()"><i class="fas fa-microphone"></i></button>
                    <button class="send-btn" onclick="messenger.send()"><i class="fas fa-paper-plane"></i></button>
                    
                    <div id="sticker-panel" class="sticker-panel hidden">
                        <div class="sticker-grid" id="sticker-grid"></div>
                        <div class="sticker-add">
                            <input type="text" id="st-url" placeholder="URL стикера">
                            <button onclick="messenger.addSticker()">+</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Модалки -->
    <div id="modal-overlay" class="modal-overlay hidden" onclick="ui.closeModals()">
        <!-- Настройки -->
        <div id="modal-settings" class="modal card" onclick="event.stopPropagation()">
            <h2>Профиль</h2>
            <p>ID: <strong id="my-id-val"></strong></p>
            <p>Статус: <span id="verif-val">Стандарт</span></p>
            <div id="admin-zone" class="hidden">
                <hr>
                <h4>Админ-панель</h4>
                <input type="text" id="twink-id" placeholder="ID твинка">
                <button class="btn-primary" onclick="admin.createTwink()">Создать твинк</button>
            </div>
            <button class="btn-danger" onclick="account.logout()">Выйти</button>
        </div>

        <!-- Звонок -->
        <div id="modal-call" class="modal call-card" onclick="event.stopPropagation()">
            <div class="call-ui">
                <div class="pulse"></div>
                <h3 id="call-title">Звонок...</h3>
                <div class="video-grid">
                    <video id="remote-video" autoplay playsinline></video>
                    <video id="local-video" autoplay muted playsinline></video>
                </div>
                <div class="call-actions">
                    <button class="btn-success" id="btn-accept"><i class="fas fa-phone"></i></button>
                    <button class="btn-danger" id="btn-hangup" onclick="calls.end()"><i class="fas fa-phone-slash"></i></button>
                </div>
            </div>
        </div>

        <!-- Добавить друга -->
        <div id="modal-add-peer" class="modal card" onclick="event.stopPropagation()">
            <h3>Новый чат</h3>
            <input type="text" id="new-peer-id" placeholder="ID пользователя">
            <button class="btn-primary" onclick="messenger.addContact()">Добавить</button>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
